<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacientes - Clínica de Ecografías</title>
     <!-- Bootstrap CSS -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
     <!-- CSS Personalizado -->
     <link rel="stylesheet" href="stilo.css">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img src="./img/logo.jpg" alt="Logo Ecografía Digital Machala" style="max-height: 30px;">
        </a>
        
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="index.html">Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="citas.html">Agendar Cita</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pacientes.html">Pacientes</a>
                </li>
               
            </ul>
             <!-- Menú desplegable de Configuración y Salir -->
        <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <!-- Ícono de Configuración -->Opciones
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Configuración</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="login.html" id="btn-salir"><i class="fas fa-sign-out-alt"></i> Salir</a></li>
                </ul>
        </div>
    </div>
</nav>

    <!-- Main Content -->
    <div class="container mt-5">
        <h1 class="mb-2">Pacientes</h1>
        <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalPaciente">
            Agregar Paciente
        </button>

        <!-- Tabla de Pacientes -->
        <h2 class="">Lista de Pacientes</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Cédula</th>
                    <th>Teléfono</th>
                    <th>Email</th>
                    <th>Sexo</th>
                    <th>Fecha de Nacimiento</th>
                    <th>Tipo de Ecografía</th>
                    <th>Precio</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-pacientes">
                <!-- Los pacientes se agregarán dinámicamente aquí -->
            </tbody>
        </table>
    </div>

    <!-- Modal para Agregar/Editar Paciente -->
    <div class="modal fade" id="modalPaciente" tabindex="-1" aria-labelledby="modalPacienteLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalPacienteLabel">Agregar Paciente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form-paciente">
                        <div class="mb-3">
                            <label for="nombres" class="form-label">Nombres</label>
                            <input type="text" class="form-control" id="nombres" required>
                        </div>
                        <div class="mb-3">
                            <label for="apellidos" class="form-label">Apellidos</label>
                            <input type="text" class="form-control" id="apellidos" required>
                        </div>
                        <div class="mb-3">
                            <label for="cedula" class="form-label">Cédula</label>
                            <input type="text" class="form-control" id="cedula" required>
                            <small class="text-danger" id="cedula-error" style="display: none;">Cédula inválida</small>
                        </div>
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="sexo" class="form-label">Sexo</label>
                            <select class="form-select" id="sexo" required>
                                <option value="">Seleccione</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fecha-nacimiento" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="fecha-nacimiento" required>
                        </div>
                        <div class="mb-3">
                            <label for="tipo-ecografia" class="form-label">Tipo de Ecografía</label>
                            <select class="form-select" id="tipo-ecografia" required>
                                <option value="">Seleccione un tipo</option>
                                <option value="ecografia-abdominal">Ecografía Abdominal</option>
                                <option value="ecografia-obstetrica">Ecografía Obstétrica</option>
                                <option value="ecografia-mamaria">Ecografía Mamaria</option>
                                <option value="ecografia-tiroidea">Ecografía Tiroidea</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="precio" class="form-label">Precio</label>
                            <input type="number" class="form-control" id="precio" step="0.01" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="btn-guardar-paciente">Guardar Paciente</button>
                </div>
            </div>
        </div>
    </div>

  <!-- Footer -->
  <footer class="text-white mt-auto">
    <div class="container py-4">
        <div class="row">
            <div class="col-md-6">
                <h5>Contacto</h5>
                <p>Dirección: Buenavista y Boyaca</p>
                <p>Teléfono: 0963947466</p>
                <p>Email: ecografiadigitalmachala@gmail.com</p>
            </div>
            <div class="col-md-6">
                <h5>Horario de Atención</h5>
                <p>Lunes a Viernes: 8:00 AM - 6:00 PM</p>
                <p>Sábado: 9:00 AM - 1:00 PM</p>
            </div>
        </div>
    </div>
</footer>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Script para manejar la lógica de pacientes -->
    <script>
        // Array para almacenar los pacientes
        let pacientes = [];
        let pacienteEditando = null; // Variable para almacenar el paciente que se está editando

        // Función para validar la cédula ecuatoriana
        function validarCedula(cedula) {
            if (cedula.length !== 10 || isNaN(cedula)) {
                return false;
            }
            const coeficientes = [2, 1, 2, 1, 2, 1, 2, 1, 2];
            let suma = 0;
            for (let i = 0; i < 9; i++) {
                let valor = parseInt(cedula[i]) * coeficientes[i];
                if (valor >= 10) {
                    valor = valor - 9;
                }
                suma += valor;
            }
            const digitoVerificador = parseInt(cedula[9]);
            const resultado = (suma % 10 === 0) ? 0 : 10 - (suma % 10);
            return resultado === digitoVerificador;
        }

        // Función para abrir el modal y limpiar el formulario
        function abrirModalPaciente(editar = false, paciente = null) {
            if (editar && paciente) {
                // Llenar el formulario con los datos del paciente seleccionado
                document.getElementById('nombres').value = paciente.nombres;
                document.getElementById('apellidos').value = paciente.apellidos;
                document.getElementById('cedula').value = paciente.cedula;
                document.getElementById('telefono').value = paciente.telefono;
                document.getElementById('email').value = paciente.email;
                document.getElementById('sexo').value = paciente.sexo;
                document.getElementById('fecha-nacimiento').value = paciente.fechaNacimiento;
                document.getElementById('tipo-ecografia').value = paciente.tipoEcografia;
                document.getElementById('precio').value = paciente.precio;
                pacienteEditando = paciente; // Guardar el paciente que se está editando
            } else {
                // Limpiar el formulario
                document.getElementById('form-paciente').reset();
                pacienteEditando = null; // Reiniciar la variable de edición
            }

            // Abrir el modal
            const modal = new bootstrap.Modal(document.getElementById('modalPaciente'));
            modal.show();
        }

        // Función para guardar o actualizar un paciente
        document.getElementById('btn-guardar-paciente').addEventListener('click', function () {
            // Obtener los valores del formulario
            const nombres = document.getElementById('nombres').value;
            const apellidos = document.getElementById('apellidos').value;
            const cedula = document.getElementById('cedula').value;
            const telefono = document.getElementById('telefono').value;
            const email = document.getElementById('email').value;
            const sexo = document.getElementById('sexo').value;
            const fechaNacimiento = document.getElementById('fecha-nacimiento').value;
            const tipoEcografia = document.getElementById('tipo-ecografia').value;
            const precio = document.getElementById('precio').value;

            // Validar la cédula
            if (!validarCedula(cedula)) {
                document.getElementById('cedula-error').style.display = 'block';
                return;
            } else {
                document.getElementById('cedula-error').style.display = 'none';
            }

            // Crear un objeto con los datos del paciente
            const paciente = {
                nombres,
                apellidos,
                cedula,
                telefono,
                email,
                sexo,
                fechaNacimiento,
                tipoEcografia,
                precio
            };

            if (pacienteEditando) {
                // Si se está editando, reemplazar el paciente existente
                const index = pacientes.indexOf(pacienteEditando);
                pacientes[index] = paciente;
            } else {
                // Si no, agregar el paciente al array
                pacientes.push(paciente);
            }

            // Limpiar el formulario y cerrar el modal
            document.getElementById('form-paciente').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalPaciente'));
            modal.hide();

            // Actualizar la tabla de pacientes
            actualizarTablaPacientes();
        });

        // Función para actualizar la tabla de pacientes
        function actualizarTablaPacientes() {
            const tablaPacientes = document.getElementById('tabla-pacientes');
            tablaPacientes.innerHTML = ''; // Limpiar la tabla

            // Recorrer el array de pacientes y agregar cada paciente a la tabla
            pacientes.forEach((paciente, index) => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${paciente.nombres}</td>
                    <td>${paciente.apellidos}</td>
                    <td>${paciente.cedula}</td>
                    <td>${paciente.telefono}</td>
                    <td>${paciente.email}</td>
                    <td>${paciente.sexo}</td>
                    <td>${paciente.fechaNacimiento}</td>
                    <td>${paciente.tipoEcografia}</td>
                    <td>$${paciente.precio}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="abrirModalPaciente(true, pacientes[${index}])">Editar</button>
                        <button class="btn btn-danger btn-sm" onclick="borrarPaciente(${index})">Borrar</button>
                    </td>
                `;
                tablaPacientes.appendChild(fila);
            });
        }

        // Función para borrar un paciente
        function borrarPaciente(index) {
            pacientes.splice(index, 1);
            actualizarTablaPacientes();
        }
    </script>
</body>
</html>